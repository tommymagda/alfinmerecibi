<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ú® Editor de Fotos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #a855f7;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #a855f7;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">‚ú® Editor de Fotos</h1>
            <p class="text-purple-200">Retoca y mejora tus selfies con filtros profesionales</p>
        </div>

        <!-- Upload Section -->
        <div id="uploadSection" class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 mb-6 text-center">
            <div class="text-6xl mb-4">üì∏</div>
            <h2 class="text-2xl text-white font-bold mb-4">Carga tu foto</h2>
            <label class="inline-block bg-gradient-to-r from-pink-500 to-purple-500 text-white px-8 py-4 rounded-full font-bold cursor-pointer hover:shadow-lg transition-all">
                üñº Seleccionar Foto
                <input type="file" accept="image/*" id="imageInput" class="hidden">
            </label>
            <p class="text-purple-200 mt-4 text-sm">O toma una foto desde la c√°mara</p>
        </div>

        <!-- Editor Section -->
        <div id="editorSection" class="space-y-6 hidden">
            <!-- Canvas Preview -->
            <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-white">üëÅÔ∏è Vista Previa</h3>
                    <button id="closeBtn" class="bg-red-500 text-white px-4 py-2 rounded-full font-bold hover:bg-red-600 transition-all">
                        ‚úï Cerrar
                    </button>
                </div>
                
                <div class="flex justify-center mb-4">
                    <div id="canvasContainer">
                        <canvas id="canvas" class="max-w-full rounded-2xl shadow-2xl"></canvas>
                    </div>
                </div>

                <!-- Filtros tipo Instagram -->
                <div class="mb-6">
                    <h4 class="text-white font-bold mb-3">üé® Filtros</h4>
                    <div id="filtersContainer" class="grid grid-cols-4 sm:grid-cols-8 gap-2 max-h-40 overflow-y-auto"></div>
                </div>

                <!-- Ajustes Manuales -->
                <div class="space-y-4">
                    <h4 class="text-white font-bold">‚öôÔ∏è Ajustes Manuales</h4>
                    
                    <!-- Brillo -->
                    <div>
                        <label class="text-white text-sm font-semibold flex justify-between mb-1">
                            <span>‚òÄÔ∏è Brillo</span>
                            <span id="brightnessValue">100%</span>
                        </label>
                        <input type="range" min="50" max="150" value="100" id="brightnessSlider" class="w-full">
                    </div>

                    <!-- Contraste -->
                    <div>
                        <label class="text-white text-sm font-semibold flex justify-between mb-1">
                            <span>üé≠ Contraste</span>
                            <span id="contrastValue">100%</span>
                        </label>
                        <input type="range" min="50" max="150" value="100" id="contrastSlider" class="w-full">
                    </div>

                    <!-- Saturaci√≥n -->
                    <div>
                        <label class="text-white text-sm font-semibold flex justify-between mb-1">
                            <span>üåà Saturaci√≥n</span>
                            <span id="saturationValue">100%</span>
                        </label>
                        <input type="range" min="0" max="200" value="100" id="saturationSlider" class="w-full">
                    </div>

                    <!-- Suavizado de Piel -->
                    <div>
                        <label class="text-white text-sm font-semibold flex justify-between mb-1">
                            <span>‚ú® Suavizado (Rejuvenecimiento)</span>
                            <span id="smoothingValue">0</span>
                        </label>
                        <input type="range" min="0" max="10" value="0" id="smoothingSlider" class="w-full">
                    </div>
                </div>

                <!-- Botones de Acci√≥n -->
                <div class="flex flex-wrap gap-3 mt-6">
                    <button id="autoEnhanceBtn" class="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-full font-bold hover:shadow-lg transition-all">
                        ‚ú® Retoque Autom√°tico
                    </button>
                    <button id="resetBtn" class="flex-1 bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-6 py-3 rounded-full font-bold hover:shadow-lg transition-all">
                        üîÑ Resetear
                    </button>
                    <button id="downloadBtn" class="flex-1 bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-6 py-3 rounded-full font-bold hover:shadow-lg transition-all">
                        üíæ Descargar
                    </button>
                </div>
            </div>

            <!-- Tips -->
            <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-6">
                <h4 class="text-white font-bold mb-3">üí° Consejos</h4>
                <ul class="text-purple-200 text-sm space-y-2">
                    <li>‚Ä¢ Usa <strong>"Retoque Autom√°tico"</strong> para mejora instant√°nea</li>
                    <li>‚Ä¢ El <strong>Suavizado</strong> reduce imperfecciones de la piel</li>
                    <li>‚Ä¢ Aumenta el <strong>Brillo</strong> para fotos m√°s luminosas</li>
                    <li>‚Ä¢ Los filtros se aplican sobre los ajustes manuales</li>
                </ul>
            </div>
        </div>

        <!-- Instrucciones de integraci√≥n -->
        <div id="instructionsSection" class="bg-white/10 backdrop-blur-lg rounded-3xl p-6 mt-6">
            <h3 class="text-xl font-bold text-white mb-4">üîß C√≥mo integrarlo</h3>
            <div class="text-purple-200 text-sm space-y-2">
                <p><strong>1.</strong> Este editor funciona 100% en el navegador (gratis)</p>
                <p><strong>2.</strong> Puedes agregarlo como nueva p√°gina en tu sitio</p>
                <p><strong>3.</strong> Los filtros se aplican antes de subir a Cloudinary</p>
                <p><strong>4.</strong> Tambi√©n puedes usar las transformaciones de Cloudinary en las URLs</p>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let originalImage = null;
        let currentFilter = 'none';
        let brightness = 100;
        let contrast = 100;
        let saturation = 100;
        let smoothing = 0;

        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const canvasContainer = document.getElementById('canvasContainer');

        // Filtros tipo Instagram
        const filters = [
            { name: 'none', label: 'Original', css: 'none' },
            { name: 'clarendon', label: 'Clarendon', css: 'contrast(1.2) saturate(1.35)' },
            { name: 'gingham', label: 'Gingham', css: 'brightness(1.05) hue-rotate(-10deg)' },
            { name: 'moon', label: 'Luna', css: 'grayscale(1) contrast(1.1) brightness(1.1)' },
            { name: 'lark', label: 'Alondra', css: 'contrast(0.9) brightness(1.1) saturate(1.2)' },
            { name: 'reyes', label: 'Reyes', css: 'sepia(0.22) brightness(1.1) contrast(0.85)' },
            { name: 'juno', label: 'Juno', css: 'sepia(0.35) contrast(1.15) brightness(1.15) saturate(1.8)' },
            { name: 'slumber', label: 'Sue√±o', css: 'saturate(0.66) brightness(1.05)' },
            { name: 'aden', label: 'Aden', css: 'hue-rotate(-20deg) contrast(0.9) saturate(0.85) brightness(1.2)' },
            { name: 'perpetua', label: 'Perpetua', css: 'contrast(1.1) brightness(1.05)' },
            { name: 'amaro', label: 'Amaro', css: 'hue-rotate(-10deg) contrast(0.9) brightness(1.1) saturate(1.5)' },
            { name: 'mayfair', label: 'Mayfair', css: 'contrast(1.1) saturate(1.1)' },
            { name: 'rise', label: 'Amanecer', css: 'sepia(0.2) contrast(0.9) brightness(1.05) saturate(0.9)' },
            { name: 'valencia', label: 'Valencia', css: 'sepia(0.25) brightness(1.08) contrast(1.05)' },
            { name: 'walden', label: 'Walden', css: 'sepia(0.35) contrast(0.8) brightness(1.15) saturate(1.6)' },
            { name: 'hudson', label: 'Hudson', css: 'contrast(0.9) brightness(1.2) saturate(1.1)' }
        ];

        // Cargar filtros en el DOM
        function loadFilters() {
            const container = document.getElementById('filtersContainer');
            filters.forEach(filter => {
                const btn = document.createElement('button');
                btn.textContent = filter.label;
                btn.className = 'p-2 rounded-lg text-xs font-bold transition-all bg-white/20 text-white hover:bg-white/30';
                btn.onclick = () => {
                    currentFilter = filter.name;
                    updateFilterButtons();
                    applyFilter();
                };
                btn.dataset.filter = filter.name;
                container.appendChild(btn);
            });
        }

        function updateFilterButtons() {
            document.querySelectorAll('#filtersContainer button').forEach(btn => {
                if (btn.dataset.filter === currentFilter) {
                    btn.className = 'p-2 rounded-lg text-xs font-bold transition-all bg-purple-500 text-white';
                } else {
                    btn.className = 'p-2 rounded-lg text-xs font-bold transition-all bg-white/20 text-white hover:bg-white/30';
                }
            });
        }

        function applyFilter() {
            const filter = filters.find(f => f.name === currentFilter);
            canvasContainer.style.filter = filter ? filter.css : 'none';
        }

        // Cargar imagen
        document.getElementById('imageInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        originalImage = img;
                        drawImageToCanvas(img);
                        document.getElementById('uploadSection').classList.add('hidden');
                        document.getElementById('instructionsSection').classList.add('hidden');
                        document.getElementById('editorSection').classList.remove('hidden');
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Dibujar imagen en canvas
        function drawImageToCanvas(img) {
            const maxWidth = 600;
            const maxHeight = 800;
            
            let width = img.width;
            let height = img.height;

            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
            }

            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
        }

        // Aplicar ajustes
        function applyAdjustments() {
            if (!originalImage) return;

            drawImageToCanvas(originalImage);

            // Aplicar suavizado
            if (smoothing > 0) {
                ctx.filter = `blur(${smoothing / 20}px)`;
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
            }

            // Aplicar ajustes de color
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            const brightnessAdj = brightness / 100;
            const contrastAdj = contrast / 100;
            const saturationAdj = saturation / 100;

            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];

                // Brillo
                r *= brightnessAdj;
                g *= brightnessAdj;
                b *= brightnessAdj;

                // Contraste
                r = ((r / 255 - 0.5) * contrastAdj + 0.5) * 255;
                g = ((g / 255 - 0.5) * contrastAdj + 0.5) * 255;
                b = ((b / 255 - 0.5) * contrastAdj + 0.5) * 255;

                // Saturaci√≥n
                const gray = 0.2989 * r + 0.5870 * g + 0.1140 * b;
                r = gray + (r - gray) * saturationAdj;
                g = gray + (g - gray) * saturationAdj;
                b = gray + (b - gray) * saturationAdj;

                data[i] = Math.max(0, Math.min(255, r));
                data[i + 1] = Math.max(0, Math.min(255, g));
                data[i + 2] = Math.max(0, Math.min(255, b));
            }

            ctx.putImageData(imageData, 0, 0);
        }

        // Retoque autom√°tico
        document.getElementById('autoEnhanceBtn').addEventListener('click', () => {
            if (!originalImage) return;

            drawImageToCanvas(originalImage);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];

                if (r > 95 && g > 40 && b > 20 && r > g && r > b && Math.abs(r - g) > 15) {
                    data[i] = Math.min(255, r * 1.05);
                    data[i + 1] = Math.min(255, g * 1.05);
                    data[i + 2] = Math.min(255, b * 1.05);
                }
            }

            ctx.putImageData(imageData, 0, 0);
        });

        // Resetear
        document.getElementById('resetBtn').addEventListener('click', () => {
            brightness = 100;
            contrast = 100;
            saturation = 100;
            smoothing = 0;
            
            document.getElementById('brightnessSlider').value = 100;
            document.getElementById('contrastSlider').value = 100;
            document.getElementById('saturationSlider').value = 100;
            document.getElementById('smoothingSlider').value = 0;
            
            document.getElementById('brightnessValue').textContent = '100%';
            document.getElementById('contrastValue').textContent = '100%';
            document.getElementById('saturationValue').textContent = '100%';
            document.getElementById('smoothingValue').textContent = '0';
            
            if (originalImage) {
                drawImageToCanvas(originalImage);
            }
        });

        // Descargar
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = `foto-editada-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        // Cerrar
        document.getElementById('closeBtn').addEventListener('click', () => {
            originalImage = null;
            document.getElementById('uploadSection').classList.remove('hidden');
            document.getElementById('instructionsSection').classList.remove('hidden');
            document.getElementById('editorSection').classList.add('hidden');
            document.getElementById('imageInput').value = '';
        });

        // Event listeners para sliders
        document.getElementById('brightnessSlider').addEventListener('input', (e) => {
            brightness = Number(e.target.value);
            document.getElementById('brightnessValue').textContent = brightness + '%';
            applyAdjustments();
        });

        document.getElementById('contrastSlider').addEventListener('input', (e) => {
            contrast = Number(e.target.value);
            document.getElementById('contrastValue').textContent = contrast + '%';
            applyAdjustments();
        });

        document.getElementById('saturationSlider').addEventListener('input', (e) => {
            saturation = Number(e.target.value);
            document.getElementById('saturationValue').textContent = saturation + '%';
            applyAdjustments();
        });

        document.getElementById('smoothingSlider').addEventListener('input', (e) => {
            smoothing = Number(e.target.value);
            document.getElementById('smoothingValue').textContent = smoothing;
            applyAdjustments();
        });

        // Inicializar filtros
        loadFilters();
    </script>
</body>
</html>